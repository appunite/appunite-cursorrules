---
description: 
globs: *.ex
alwaysApply: false
---
# Phoenix Framework & Elixir Generators First

## Core Principle
**Always use Phoenix and Elixir generators before manually creating code.** Generators ensure consistency, follow best practices, and maintain proper project structure.

## Database & Schema Operations

### ✅ DO: Use Ecto Generators
```bash
# Create database migrations
mix ecto.gen.migration create_users_table

# Generate schema with migration
mix phx.gen.schema Accounts.User users email:string name:string

# Generate embedded schemas
mix phx.gen.embedded UserProfile name:string bio:text
```

### ❌ DON'T: Manually create migrations or schemas
- Don't hand-write migration files from scratch
- Don't create schema files without using generators
- Don't skip migration generation for schema changes

## Context & Business Logic

### ✅ DO: Use Context Generators
```bash
# Generate complete context with CRUD operations
mix phx.gen.context Accounts User users name:string email:string

# This creates:
# - lib/app/accounts.ex (context module)
# - lib/app/accounts/user.ex (schema)
# - priv/repo/migrations/*_create_users.exs
# - Complete test files
```

Generates a context with functions around an Ecto schema.

    $ mix phx.gen.context Accounts User users name:string age:integer

The first argument is the context module followed by the schema module and its
plural name (used as the schema table name).

The context is an Elixir module that serves as an API boundary for the given
resource. A context often holds many related resources. Therefore, if the
context already exists, it will be augmented with functions for the given
resource.

> Note: A resource may also be split over distinct contexts (such as
> Accounts.User and Payments.User).

The schema is responsible for mapping the database fields into an Elixir
struct.

Overall, this generator will add the following files to lib/your_app:

  • a context module in accounts.ex, serving as the API boundary
  • a schema in accounts/user.ex, with a users table

A migration file for the repository and test files for the context will also be
generated.

#### Generating without a schema

In some cases, you may wish to bootstrap the context module and tests, but
leave internal implementation of the context and schema to yourself. Use the
--no-schema flags to accomplish this.

#### table

By default, the table name for the migration and schema will be the plural name
provided for the resource. To customize this value, a --table option may be
provided. For example:

    $ mix phx.gen.context Accounts User users --table cms_users

#### binary_id

Generated migration can use binary_id for schema's primary key and its
references with option --binary-id.

#### Default options

This generator uses default options provided in the :generators configuration
of your application. These are the defaults:

    config :your_app, :generators,
      migration: true,
      binary_id: false,
      timestamp_type: :naive_datetime,
      sample_binary_id: "11111111-1111-1111-1111-111111111111"

You can override those options per invocation by providing corresponding
switches, e.g. --no-binary-id to use normal ids despite the default
configuration or --migration to force generation of the migration.

Read the documentation for phx.gen.schema for more information on attributes.

#### Skipping prompts

This generator will prompt you if there is an existing context with the same
name, in order to provide more instructions on how to correctly use phoenix
contexts. You can skip this prompt and automatically merge the new schema
access functions and tests into the existing context using
--merge-with-existing-context. To prevent changes to the existing context and
exit the generator, use --no-merge-with-existing-context.




### Benefits of Context Generators:
- **Consistent API patterns**: Standard CRUD functions
- **Proper error handling**: Tagged tuple returns `{:ok, result}` | `{:error, changeset}`
- **Test coverage**: Generated tests follow Phoenix conventions
- **Documentation**: Proper @doc annotations

## Web Interface Generation

### ✅ DO: Use Phoenix Web Generators

**For HTML interfaces:**
```bash
mix phx.gen.html Accounts User users name:string email:string
```

**For JSON APIs:**
```bash
mix phx.gen.json Accounts User users name:string email:string
```

**For LiveView interfaces:**
```bash
mix phx.gen.live Accounts User users name:string email:string
```

**For Authentication:**
```bash
mix phx.gen.auth Accounts User users
```

### Generated Components Include:
- **Controllers** with proper error handling
- **Views/Components** following Phoenix conventions  
- **Templates** with accessibility features
- **Routes** properly configured
- **Tests** with comprehensive coverage

## Real-time & Communication

### ✅ DO: Use Phoenix Communication Generators
```bash
# Generate channels for real-time features
mix phx.gen.channel Room

# Generate presence tracking
mix phx.gen.presence

# Generate notifiers for emails
mix phx.gen.notifier Accounts.UserNotifier

# Generate sockets for WebSocket connections
mix phx.gen.socket UserSocket
```

## Project Structure

### ✅ DO: Use Project Generators
```bash
# Create new Phoenix applications
mix phx.new my_app

# Create Ecto-only projects in umbrella
mix phx.new.ecto my_data_app

# Create web-only projects in umbrella  
mix phx.new.web my_web_app
```

## Development Utilities

### ✅ DO: Use Development Generators
```bash
# Generate development certificates
mix phx.gen.cert

# Generate secure secrets
mix phx.gen.secret
```

## Generator Workflow for This Project

### When Adding New Features:

1. **Start with Schema**: `mix phx.gen.schema Context.Resource resources field:type`
2. **Add Context Logic**: Use generated context as base, extend as needed
3. **Add Web Interface**: Choose appropriate generator (html/json/live)
4. **Add Real-time**: Use channel/presence generators if needed
5. **Add Notifications**: Use notifier generator for emails

### Example: Adding User Profiles
```bash
# 1. Generate the schema and context
mix phx.gen.context Accounts UserProfile user_profiles user_id:references:users bio:text avatar_url:string

# 2. Generate LiveView interface
mix phx.gen.live Accounts UserProfile user_profiles bio:text avatar_url:string

# 3. Generate notifier for profile updates
mix phx.gen.notifier Accounts.ProfileNotifier
```

## Project-Specific Generator Usage

### For [holocron](mdc:empowered_house/apps/holocron) App:
- Use `mix phx.gen.context` for business logic (Accounts, Opportunities)
- Use `mix phx.gen.schema` for data models
- Use `mix ecto.gen.migration` for database changes

### For [holocron_web](mdc:empowered_house/apps/holocron_web) App:
- Use `mix phx.gen.live` for interactive admin interfaces
- Use `mix phx.gen.json` for API endpoints
- Use `mix phx.gen.channel` for real-time features

### For [chat_rfp_web](mdc:empowered_house/apps/chat_rfp_web) App:
- Use `mix phx.gen.live` for chat interfaces
- Use `mix phx.gen.presence` for user presence tracking
- Use `mix phx.gen.channel` for real-time chat

## Best Practices

### Generator Command Patterns:
```bash
# Always specify the context
mix phx.gen.context Accounts User users email:unique

# Use proper field types
mix phx.gen.schema Blog Post posts title:string body:text published_at:datetime

# Include references
mix phx.gen.context Blog Comment comments post_id:references:posts content:text

# Use array types when needed  
mix phx.gen.schema Accounts User users skills:array:string
```

### After Generator Usage:
1. **Review generated code** for project-specific customizations
2. **Run tests** to ensure everything works: `mix test`
3. **Update routes** if needed: `mix phx.routes`
4. **Customize templates** to match project styling
5. **Add business logic** to generated context functions

## Anti-Patterns to Avoid

❌ **Don't**:
- Create controllers manually without using generators
- Write migration files from scratch  
- Skip generating tests with `--no-tests`
- Generate code without considering the context structure
- Create schemas without migrations
- Write HTML templates manually before trying `mix phx.gen.html`

✅ **Do**:
- Always run generators first, then customize
- Use `--dry-run` to preview generator output
- Check `mix help` for generator options
- Follow generated patterns for consistency
- Extend generated code rather than replacing it

## Reference Commands

### Most Common Generators:
```bash
mix phx.gen.context    # Business logic + schema + migration
mix phx.gen.live       # LiveView interface + context
mix phx.gen.json       # JSON API + context  
mix phx.gen.html       # HTML interface + context
mix ecto.gen.migration # Database migration only
mix phx.gen.auth       # Complete authentication system
```

### Check Available Options:
```bash
mix help phx.gen.context
mix help phx.gen.live
mix help ecto.gen.migration
```

Remember: **Generators are your friend** - they implement Phoenix conventions, handle edge cases, and provide a solid foundation for customization.
